server {
    listen 80;

    # HANDLE /pma (dengan atau tanpa slash)
    location /pma/ {
        proxy_pass http://pma/; # Pastikan nama service sesuai di docker-compose (pma/phpmyadmin)
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # Penting agar redirect dari phpMyAdmin tetap berada di subpath /pma/
        proxy_redirect http://pma/ /pma/;
    }

    # Redirect otomatis dari /pma ke /pma/ agar cookie session tetap valid
    location = /pma {
        return 301 $scheme://$http_host/pma/;
    }

    # WORDPRESS DEFAULT
    location / {
        proxy_pass http://wp;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
